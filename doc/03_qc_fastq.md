#1. QC analysis software provided by the vendor 
In general, most vendors of instruments provide a sequencing quality monitoring application. For example, Illumina developed Sequencing Analysis Viewer ([SAV](https://support.illumina.com/sequencing/sequencing_software/sequencing_analysis_viewer_sav.html)), an application that allows you, in real time, to view essential quality metrics generated by the Real-Time Analysis (RTA) software on the Illumina sequencing systems.

# Converting raw sequencing data to FASTQ file format
##2. Raw sequencing data
In general, FASTQ files are derived from a raw sequencing output (e.g., bcl files in Illumina sequencer, 'squiggle' electric current magnitude raw file in Oxford Nanopore technology) data generated by a sequencer.

##3. Conversion/Base call algorithm 
For instance, refer to conversion software, [bcl2fastq](https://support.illumina.com/sequencing/sequencing_software/bcl2fastq-conversion-software.html) for Illumina and [albacore](https://community.nanoporetech.com/downloads) for Oxford Nanopore technology). 
 
The bcl2fastq conversion process is already embedded in most Illumina sequencing system with a default option (processing multiplexing samples and trimming barcode/adaptors).

# Quality Assessment of FASTQ files
##4. Understanding FASTQ file format
One sequenced read is composed of 4 lines. The first and third row are header. The consensus base calls are represented in the second row and the quality of bases are encoded into ASCII format to represent a sequecning error in the fourth row. The header contains the instrument name, flowcell lane/number, cluster coordinates, barcodes, and the member of a pair. Check [here](https://en.wikipedia.org/wiki/FASTQ_format) for more details. 
1. Task: Check FATQ file format
    1. `fastq` # change to fastq file directory
    1. Q19: Display first 8 lines of the fastq file, `chr7a.R1_001.fastq.gz`
    1. Q20: what is the read length?
    1. Q20a: Visit [here](https://www.drive5.com/usearch/manual/quality_score.html) to get some idea of the base quality
1. Q21: Is these paired end reads?
    1. `zcat chr7a.R2_001.fastq.gz | head -n 8`
1. Q22: How many reads are there?
1. Task: Exploring the FASTQ file more
    1. `zcat chr7a.R1_001.fastq.gz | awk '/^@/{getline; print}' | less -S`
    1. then, type `/`, `A`, and hit `enter` to see where bases A's are called in the FASTQ file

##5. FastQC
[FastQC](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/) provides a modular set of analyses on FASTQ files to give a quick impression of whether your data any problems of which you should be aware before doing any further analysis. The primary functions include some basic statistics, sequence quality per base or per tile, distribution of mean sequence quality, GC contents, sequence length distribution, overrepresented sequences, and adapter content.

###6. Run FastQC from GUI and browse the results
1. Make sure that your current ssh connection forwards to X11
1. `fastqc &`
1. file -> open
1. go to `~/projects/bioinfo_2018/fastq`
1. select  `chr7a.R*_001.fastq.gz` (holding `ctrl` key and select files) and open
1. Explore the reports and group discussion (5 min)
1. [Sequence Duplication Levels](http://proteo.me.uk/2013/09/a-new-way-to-look-at-duplication-in-fastqc-v0-11/)

###7. The other FastQC report example
- [Bad Illumina Data](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/bad_sequence_fastqc.html) 

###8. Run FastQC from command line
Run a program with `-h` to know which options are available and required.
1. `fastq -h`
##9. Preprocessing read sequences
1. Many ways to preprocess fastq files
Depending on an appliction or sequencing option, you may need preprocess sequencing reads. The processes include trimming adaptors, trim 3' ends if the sequencing error rate is below than a certain threshold, removing reads because the read length is too short after trimming, removing reads containing numerous homopolymer regions (or lower complexity). The preprocess is very useful in metagenomics analysis.
1. A suggestion:
    1. Garbage in and garbage out
    1. If you know artificial genomic segments (e.g., barcodes or adaptors), we encourage to get rid of it.
1. In our demo, this task will be skipped since BWA mem supports a softclipping when reads at the 3'end does not match or have poor base quality.

###10. An Optional Task
1. Download TrimGalore
    1. Make a directory under $HOME (e.g., ~/apps) if you don't have it
    1. Download `https://github.com/FelixKrueger/TrimGalore/archive/0.4.5.zip` into `~/apps` using `wget` command
    1. Extract the download file into your $HOME/apps directory
1. Run preprocess fastq files
    1.`fastq`
    1. Analyze `sample4qc.R?_001.fastq.gz` with FastQC
    1. Run TrimGalore on `sample4qc.R?_001.fastq.gz`
    1. Check TrimGalore output
 
###11. List FASTQ files to work with (Optional)
1. `binf`
1. `ls fastq/*R?_001.fastq.gz`
    1. the subdirectory `fastq` under the current directory contains FASTQ files.
    1. list out files where filename contains `*R?_001.fastq.gz` in the subdirectory. Note that `*` can match any letter and `?` means any one position.
1. `ls fastq/*R?_001.fastq.gz | rev | cut -c 17- | rev | uniq`
    1. `rev` means reverse the output of `ls` command above
    1. `cut -c 17-` means trim first 17 positions of the outputs
    1. `rev` means reverse the trimmed outputs again
    1. `uniq` collapse redundant items to get unique file list